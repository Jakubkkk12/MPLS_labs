annotations:
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 100.12.20.0/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -500.0
    y1: -184.0
    z_index: 4
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 34
    text_bold: false
    text_content: 173.45.21.32/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -92.0
    y1: -82.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 315
    text_bold: false
    text_content: 150.30.120.0/24
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -181.0
    y1: -208.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 10.10.0.25/16
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 64.0
    y1: -387.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 2001:db8::10:30:25/112
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 66.0
    y1: -22.0
    z_index: 1
  - border_color: '#7ED266'
    border_style: ''
    color: '#7ED266'
    thickness: 4
    type: ellipse
    x1: -260.0
    y1: -400.0
    x2: 140.0
    y2: 40.0
    z_index: 2
  - border_color: '#03DEB7'
    border_style: ''
    color: '#03DEB7'
    thickness: 3
    type: ellipse
    x1: -560.0
    y1: -200.0
    x2: 40.0
    y2: 80.0
    z_index: 3
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 2001:db8::10:10:25/112
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 66.0
    y1: -422.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 2001:db8::10:100:25/112
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -814.0
    y1: -182.0
    z_index: 4
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 10.30.0.25/16
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 64.0
    y1: 13.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 5.5.5.5/32
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 64.0
    y1: -147.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 5:5:5::5/128
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 64.0
    y1: -187.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 10.100.0.25/16
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -816.0
    y1: -147.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 314
    text_bold: false
    text_content: DHCP
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -21.0
    y1: -368.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: DHCP
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -14.0
    y1: -422.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: DHCP
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -14.0
    y1: -182.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 24.0.200.0/24
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -174.0
    y1: -182.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 32.47.82.0/24
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -174.0
    y1: -422.0
    z_index: 3
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: 10.0.10.0/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -334.0
    y1: -422.0
    z_index: 3
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 13
    text_bold: false
    text_content: 100.12.20.4/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -420.0
    y1: -224.0
    z_index: 4
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 321
    text_bold: false
    text_content: 132.62.78.16/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -526.9986326455746
    y1: -292.9982419728814
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 310
    text_bold: false
    text_content: 132.62.78.20/30
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: -494.0
    y1: -222.0
    z_index: 1
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: |-
      Implement IPv6overIPv4 DMVPN Phase 3 with IPSec (IKEv2):
      1) Implement IPSec profile with pre-sheard key DMVPN-PRE-SHARED-KEY and transform-set ESP-AES256 ESP-SHA512-HMAC
      2) Implement FVRF (Front Door) for DMVPN
      3) Implement Tunnel100 on HQ, NHS (HUB) and BR1-BR3 (Spoke NHS has heighter priority)
      4) Enabel EIGRP in named mode as overlay to connect all sites
      5) Test connectivity between sites
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 360.0
    y1: -520.0
    z_index: 5
  - border_color: '#00000000'
    border_style: ''
    color: '#000000'
    rotation: 0
    text_bold: false
    text_content: |-
      do sh dmvpn | beg Int
      do sh dmvpn det | beg Int
      do sh ipv6 nhrp br | beg Int
      do sh ipv6 nhrp det | beg Int
      do sh eigrp add ipv6 200 nei
      do sh ipv6 route | beg Gat
      do sh ipv6 route nhrp

      do sh ipv6 nhrp sum
      do sh ipv6 nhrp stats
      do ping
      do traceroute

      do sh cryp ips sa
      do sh cryp ips prof
      do sh cryp ips tran
      do sh cryp ips sec
      do sh cryp ikev2 sa
      do sh cryp ikev2 prof
      do sh cryp ikev2 stats
    text_font: monospace
    text_italic: false
    text_size: 12
    text_unit: pt
    thickness: 1
    type: text
    x1: 360.0
    y1: -360.0
    z_index: 5
nodes:
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          Building configuration...

          Current configuration : 4767 bytes
          !
          ! Last configuration change at 21:58:35 UTC Tue Apr 15 2025
          !
          version 15.9
          service timestamps debug datetime msec
          service timestamps log datetime msec
          no service password-encryption
          !
          hostname BR3
          !
          boot-start-marker
          boot-end-marker
          !
          !
          vrf definition FDOOR-DMVPN
           !
           address-family ipv4
           exit-address-family
          !
          no logging console
          !
          no aaa new-model
          !
          !
          !
          mmi polling-interval 60
          no mmi auto-configure
          no mmi pvc
          mmi snmp-timeout 180
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          no ip domain lookup
          ip cef
          ipv6 unicast-routing
          ipv6 cef
          !
          multilink bundle-name authenticated
          !
          !
          !
          !
          !
          redundancy
          !
          !
          !
          !
          !
          !
          crypto ikev2 keyring IKEV2-KEYRING-DMVPN
           peer ANY-IPv4
            address 0.0.0.0 0.0.0.0
            pre-shared-key DMVPN-PRE-SHARED-KEY
           !
          !
          !
          crypto ikev2 profile IKEV2-PROFILE-DMVPN
           match fvrf FDOOR-DMVPN
           match identity remote address 0.0.0.0
           authentication remote pre-share
           authentication local pre-share
           keyring local IKEV2-KEYRING-DMVPN
           lifetime 300
          !
          !
          !
          crypto ipsec transform-set IPSEC-TRANSFORM-SET-DMVPN esp-aes 256 esp-sha512-hmac
           mode transport
          !
          crypto ipsec profile IPSCE-PROFILE-DMVPN
           set transform-set IPSEC-TRANSFORM-SET-DMVPN
           set ikev2-profile IKEV2-PROFILE-DMVPN
          !
          !
          !
          !
          !
          !
          !
          interface Tunnel100
           bandwidth 1000000
           no ip address
           no ip redirects
           delay 50
           ipv6 address FE80:100::3 link-local
           ipv6 address 6000::6666:3/112
           ipv6 mtu 1380
           ipv6 tcp adjust-mss 1340
           ipv6 nhrp authentication NHRP-PAS
           ipv6 nhrp network-id 100
           ipv6 nhrp nhs 6000::6666:1002 nbma 100.12.20.2 multicast priority 200
           ipv6 nhrp nhs 6000::6666:1001 nbma 100.12.20.6 multicast priority 50
           if-state nhrp
           tunnel source GigabitEthernet0/3
           tunnel mode gre multipoint
           tunnel key 1500
           tunnel vrf FDOOR-DMVPN
           tunnel protection ipsec profile IPSCE-PROFILE-DMVPN
          !
          interface GigabitEthernet0/0
           ip address 10.30.0.25 255.255.255.0
           duplex auto
           speed auto
           media-type rj45
           ipv6 address 2001:DB8::10:30:25/112
          !
          interface GigabitEthernet0/1
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/2
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/3
           vrf forwarding FDOOR-DMVPN
           ip address 173.45.21.34 255.255.255.252
           duplex auto
           speed auto
           media-type rj45
          !
          !
          router eigrp DMVPN-OVERLAY
           !
           address-family ipv6 unicast autonomous-system 200
            !
            af-interface default
             shutdown
            exit-af-interface
            !
            af-interface GigabitEthernet0/0
             no shutdown
             passive-interface
            exit-af-interface
            !
            af-interface Tunnel100
             no shutdown
            exit-af-interface
            !
            topology base
            exit-af-topology
            eigrp router-id 0.0.0.3
           exit-address-family
          !
          ip forward-protocol nd
          !
          !
          no ip http server
          no ip http secure-server
          ip route vrf FDOOR-DMVPN 0.0.0.0 0.0.0.0 173.45.21.33
          !
          ipv6 ioam timestamp
          !
          !
          !
          control-plane
          !
          banner exec ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner incoming ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner login ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          !
          line con 0
           exec-timeout 0 0
          line aux 0
          line vty 0 4
           exec-timeout 0 0
           login
           transport input none
          !
          no scheduler allocate
          !
          end
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n0
    image_definition: null
    label: BR3
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: 40
    y: 0
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          Building configuration...

          Current configuration : 4681 bytes
          !
          ! Last configuration change at 21:58:27 UTC Tue Apr 15 2025
          !
          version 15.9
          service timestamps debug datetime msec
          service timestamps log datetime msec
          no service password-encryption
          !
          hostname BR1
          !
          boot-start-marker
          boot-end-marker
          !
          !
          vrf definition FDOOR-DMVPN
           !
           address-family ipv4
           exit-address-family
          !
          no logging console
          !
          no aaa new-model
          !
          !
          !
          mmi polling-interval 60
          no mmi auto-configure
          no mmi pvc
          mmi snmp-timeout 180
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          no ip domain lookup
          ip cef
          ipv6 unicast-routing
          ipv6 cef
          !
          multilink bundle-name authenticated
          !
          !
          !
          !
          !
          redundancy
          !
          !
          !
          !
          !
          !
          crypto ikev2 keyring IKEV2-KEYRING-DMVPN
           peer ANY-IPv4
            address 0.0.0.0 0.0.0.0
            pre-shared-key DMVPN-PRE-SHARED-KEY
           !
          !
          !
          crypto ikev2 profile IKEV2-PROFILE-DMVPN
           match fvrf FDOOR-DMVPN
           match identity remote address 0.0.0.0
           authentication remote pre-share
           authentication local pre-share
           keyring local IKEV2-KEYRING-DMVPN
           lifetime 300
          !
          !
          !
          crypto ipsec transform-set IPSEC-TRANSFORM-SET-DMVPN esp-aes 256 esp-sha512-hmac
           mode transport
          !
          crypto ipsec profile IPSCE-PROFILE-DMVPN
           set transform-set IPSEC-TRANSFORM-SET-DMVPN
           set ikev2-profile IKEV2-PROFILE-DMVPN
          !
          !
          !
          !
          !
          !
          !
          interface Tunnel100
           bandwidth 1000000
           no ip address
           no ip redirects
           delay 50
           ipv6 address FE80:100::1 link-local
           ipv6 address 6000::6666:1/112
           ipv6 mtu 1380
           ipv6 tcp adjust-mss 1340
           ipv6 nhrp authentication NHRP-PAS
           ipv6 nhrp network-id 100
           ipv6 nhrp nhs 6000::6666:1002 nbma 100.12.20.2 multicast priority 200
           ipv6 nhrp nhs 6000::6666:1001 nbma 100.12.20.6 multicast priority 50
           if-state nhrp
           tunnel source GigabitEthernet0/1
           tunnel mode gre multipoint
           tunnel key 1500
           tunnel vrf FDOOR-DMVPN
           tunnel protection ipsec profile IPSCE-PROFILE-DMVPN
          !
          interface GigabitEthernet0/0
           ip address 10.10.0.25 255.255.255.0
           duplex auto
           speed auto
           media-type rj45
           ipv6 address 2001:DB8::10:10:25/112
          !
          interface GigabitEthernet0/1
           vrf forwarding FDOOR-DMVPN
           ip address dhcp
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/2
           ip address dhcp
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/3
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          !
          router eigrp DMVPN-OVERLAY
           !
           address-family ipv6 unicast autonomous-system 200
            !
            af-interface default
             shutdown
            exit-af-interface
            !
            af-interface GigabitEthernet0/0
             no shutdown
             passive-interface
            exit-af-interface
            !
            af-interface Tunnel100
             no shutdown
            exit-af-interface
            !
            topology base
            exit-af-topology
            eigrp router-id 0.0.0.1
           exit-address-family
          !
          ip forward-protocol nd
          !
          !
          no ip http server
          no ip http secure-server
          !
          ipv6 ioam timestamp
          !
          !
          !
          control-plane
          !
          banner exec ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner incoming ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner login ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          !
          line con 0
           exec-timeout 0 0
          line aux 0
          line vty 0 4
           exec-timeout 0 0
           login
           transport input none
          !
          no scheduler allocate
          !
          end
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n1
    image_definition: null
    label: BR1
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: 40
    y: -400
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          Building configuration...

          Current configuration : 4716 bytes
          !
          ! Last configuration change at 21:58:32 UTC Tue Apr 15 2025
          !
          version 15.9
          service timestamps debug datetime msec
          service timestamps log datetime msec
          no service password-encryption
          !
          hostname BR2
          !
          boot-start-marker
          boot-end-marker
          !
          !
          vrf definition FDOOR-DMVPN
           !
           address-family ipv4
           exit-address-family
          !
          no logging console
          !
          no aaa new-model
          !
          !
          !
          mmi polling-interval 60
          no mmi auto-configure
          no mmi pvc
          mmi snmp-timeout 180
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          no ip domain lookup
          ip cef
          ipv6 unicast-routing
          ipv6 cef
          !
          multilink bundle-name authenticated
          !
          !
          !
          !
          !
          redundancy
          !
          !
          !
          !
          !
          !
          crypto ikev2 keyring IKEV2-KEYRING-DMVPN
           peer ANY-IPv4
            address 0.0.0.0 0.0.0.0
            pre-shared-key DMVPN-PRE-SHARED-KEY
           !
          !
          !
          crypto ikev2 profile IKEV2-PROFILE-DMVPN
           match fvrf FDOOR-DMVPN
           match identity remote address 0.0.0.0
           authentication remote pre-share
           authentication local pre-share
           keyring local IKEV2-KEYRING-DMVPN
           lifetime 300
          !
          !
          !
          crypto ipsec transform-set IPSEC-TRANSFORM-SET-DMVPN esp-aes 256 esp-sha512-hmac
           mode transport
          !
          crypto ipsec profile IPSCE-PROFILE-DMVPN
           set transform-set IPSEC-TRANSFORM-SET-DMVPN
           set ikev2-profile IKEV2-PROFILE-DMVPN
          !
          !
          !
          !
          !
          !
          !
          interface Loopback5
           ip address 5.5.5.5 255.255.255.255
           ipv6 address 5:5:5::5/128
          !
          interface Tunnel100
           bandwidth 1000000
           no ip address
           no ip redirects
           delay 50
           ipv6 address FE80:100::2 link-local
           ipv6 address 6000::6666:2/112
           ipv6 mtu 1380
           ipv6 tcp adjust-mss 1340
           ipv6 nhrp authentication NHRP-PAS
           ipv6 nhrp network-id 100
           ipv6 nhrp nhs 6000::6666:1002 nbma 100.12.20.2 multicast priority 200
           ipv6 nhrp nhs 6000::6666:1001 nbma 100.12.20.6 multicast priority 50
           if-state nhrp
           tunnel source GigabitEthernet0/2
           tunnel mode gre multipoint
           tunnel key 1500
           tunnel vrf FDOOR-DMVPN
           tunnel protection ipsec profile IPSCE-PROFILE-DMVPN
          !
          interface GigabitEthernet0/0
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/1
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/2
           vrf forwarding FDOOR-DMVPN
           ip address dhcp
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/3
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          !
          router eigrp DMVPN-OVERLAY
           !
           address-family ipv6 unicast autonomous-system 200
            !
            af-interface default
             shutdown
            exit-af-interface
            !
            af-interface Loopback5
             no shutdown
             passive-interface
            exit-af-interface
            !
            af-interface Tunnel100
             no shutdown
            exit-af-interface
            !
            topology base
            exit-af-topology
            eigrp router-id 0.0.0.2
           exit-address-family
          !
          ip forward-protocol nd
          !
          !
          no ip http server
          no ip http secure-server
          !
          ipv6 ioam timestamp
          !
          !
          !
          control-plane
          !
          banner exec ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner incoming ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner login ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          !
          line con 0
           exec-timeout 0 0
          line aux 0
          line vty 0 4
           exec-timeout 0 0
           login
           transport input none
          !
          no scheduler allocate
          !
          end
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n2
    image_definition: null
    label: BR2
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: 40
    y: -160
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          hostname ISP1

          int g0/0
           ip add 100.12.20.1 255.255.255.252
           no sh

          int g0/4
           ip add 100.12.20.5 255.255.255.252
           no sh

          int g0/1
           ip add 150.30.120.1 255.255.255.0
           no sh

          int g0/2
           ip add 24.0.200.1 255.255.255.0
           no sh

          int g0/3
           ip add 173.45.21.33 255.255.255.252
           no sh

          ip dhcp excluded-address 24.0.200.1
          ip dhcp pool DHCP-BR2
           network 24.0.200.0 255.255.255.0
           default-router 24.0.200.1
           lease 10

          ip dhcp excluded-address 150.30.120.1
          ip dhcp pool DHCP-BR1
           network 150.30.120.0 255.255.255.0
           default-router 150.30.120.1
           lease 10
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n3
    image_definition: null
    label: ISP1
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: -200
    y: -160
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
      - id: i5
        label: GigabitEthernet0/4
        slot: 4
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          Building configuration...

          Current configuration : 4786 bytes
          !
          ! Last configuration change at 21:58:45 UTC Tue Apr 15 2025
          !
          version 15.9
          service timestamps debug datetime msec
          service timestamps log datetime msec
          no service password-encryption
          !
          hostname HQ
          !
          boot-start-marker
          boot-end-marker
          !
          !
          vrf definition FDOOR-DMVPN
           !
           address-family ipv4
           exit-address-family
          !
          no logging console
          !
          no aaa new-model
          !
          !
          !
          mmi polling-interval 60
          no mmi auto-configure
          no mmi pvc
          mmi snmp-timeout 180
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          no ip domain lookup
          ip cef
          ipv6 unicast-routing
          ipv6 cef
          !
          multilink bundle-name authenticated
          !
          !
          !
          !
          !
          redundancy
          !
          !
          !
          !
          !
          !
          crypto ikev2 keyring IKEV2-KEYRING-DMVPN
           peer ANY-IPv4
            address 0.0.0.0 0.0.0.0
            pre-shared-key DMVPN-PRE-SHARED-KEY
           !
          !
          !
          crypto ikev2 profile IKEV2-PROFILE-DMVPN
           match fvrf FDOOR-DMVPN
           match identity remote address 0.0.0.0
           authentication remote pre-share
           authentication local pre-share
           keyring local IKEV2-KEYRING-DMVPN
           lifetime 300
          !
          !
          !
          crypto ipsec transform-set IPSEC-TRANSFORM-SET-DMVPN esp-aes 256 esp-sha512-hmac
           mode transport
          !
          crypto ipsec profile IPSCE-PROFILE-DMVPN
           set transform-set IPSEC-TRANSFORM-SET-DMVPN
           set ikev2-profile IKEV2-PROFILE-DMVPN
          !
          !
          !
          !
          !
          !
          !
          interface Tunnel100
           bandwidth 1000000
           no ip address
           no ip redirects
           delay 50
           ipv6 address FE80:100::1002 link-local
           ipv6 address 6000::6666:1002/112
           ipv6 mtu 1380
           ipv6 tcp adjust-mss 1340
           ipv6 nhrp authentication NHRP-PAS
           ipv6 nhrp network-id 100
           ipv6 nhrp redirect
           tunnel source GigabitEthernet0/0
           tunnel mode gre multipoint
           tunnel key 1500
           tunnel vrf FDOOR-DMVPN
           tunnel protection ipsec profile IPSCE-PROFILE-DMVPN
          !
          interface GigabitEthernet0/0
           vrf forwarding FDOOR-DMVPN
           ip address 100.12.20.2 255.255.255.252
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/1
           ip address 10.100.0.25 255.255.255.0
           duplex auto
           speed auto
           media-type rj45
           ipv6 address 2001:DB8::10:100:25/112
          !
          interface GigabitEthernet0/2
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/3
           ip address 132.62.78.22 255.255.255.252
           duplex auto
           speed auto
           media-type rj45
          !
          !
          router eigrp DMVPN-OVERLAY
           !
           address-family ipv6 unicast autonomous-system 200
            !
            af-interface default
             shutdown
            exit-af-interface
            !
            af-interface Tunnel100
             summary-address 2001:DB8::10:0:0/96
             no shutdown
             no split-horizon
            exit-af-interface
            !
            af-interface GigabitEthernet0/1
             no shutdown
             passive-interface
            exit-af-interface
            !
            topology base
            exit-af-topology
            eigrp router-id 0.1.0.2
           exit-address-family
          !
          ip forward-protocol nd
          !
          !
          no ip http server
          no ip http secure-server
          ip route 0.0.0.0 0.0.0.0 100.12.20.1
          ip route 0.0.0.0 0.0.0.0 132.62.78.21
          ip route vrf FDOOR-DMVPN 0.0.0.0 0.0.0.0 100.12.20.1
          !
          ipv6 ioam timestamp
          !
          !
          !
          control-plane
          !
          banner exec ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner incoming ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner login ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          !
          line con 0
           exec-timeout 0 0
          line aux 0
          line vty 0 4
           exec-timeout 0 0
           login
           transport input none
          !
          no scheduler allocate
          !
          end
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n4
    image_definition: null
    label: HQ
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: -560
    y: -160
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC1
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco

          ip addr add
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n5
    image_definition: null
    label: PC1
    node_definition: desktop
    parameters: {}
    ram: null
    tags: []
    x: 280
    y: -400
    interfaces:
      - id: i0
        label: eth0
        slot: 0
        type: physical
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC3
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n6
    image_definition: null
    label: PC3
    node_definition: desktop
    parameters: {}
    ram: null
    tags: []
    x: -840
    y: -160
    interfaces:
      - id: i0
        label: eth0
        slot: 0
        type: physical
  - boot_disk_size: null
    configuration:
      - name: node.cfg
        content: |-
          # this is a shell script which will be sourced at boot
          hostname PC2
          # configurable user account
          USERNAME=cisco
          PASSWORD=cisco
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n7
    image_definition: null
    label: PC2
    node_definition: desktop
    parameters: {}
    ram: null
    tags: []
    x: 280
    y: 0
    interfaces:
      - id: i0
        label: eth0
        slot: 0
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          hostname ISP2-1

          int g0/0
           ip add 132.62.78.17 255.255.255.252
           no sh

          int g0/3
           ip add 132.62.78.21 255.255.255.252
           no sh

          int g0/1
           ip add 10.0.10.2 255.255.255.252
           no sh

          router ospf 150
           router-id 0.0.2.1
           auto-cost reference-bandwidth 1000000
           redistribute connected subnets
           network 10.0.10.0 0.0.0.3 area 0
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n8
    image_definition: null
    label: ISP2-1
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: -360
    y: -400
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          Building configuration...

          Current configuration : 4763 bytes
          !
          ! Last configuration change at 21:58:38 UTC Tue Apr 15 2025
          !
          version 15.9
          service timestamps debug datetime msec
          service timestamps log datetime msec
          no service password-encryption
          !
          hostname NHS
          !
          boot-start-marker
          boot-end-marker
          !
          !
          vrf definition FDOOR-DMVPN
           !
           address-family ipv4
           exit-address-family
          !
          no logging console
          !
          no aaa new-model
          !
          !
          !
          mmi polling-interval 60
          no mmi auto-configure
          no mmi pvc
          mmi snmp-timeout 180
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          !
          no ip domain lookup
          ip cef
          ipv6 unicast-routing
          ipv6 cef
          !
          multilink bundle-name authenticated
          !
          !
          !
          !
          !
          redundancy
          !
          !
          !
          !
          !
          !
          crypto ikev2 keyring IKEV2-KEYRING-DMVPN
           peer ANY-IPv4
            address 0.0.0.0 0.0.0.0
            pre-shared-key DMVPN-PRE-SHARED-KEY
           !
          !
          !
          crypto ikev2 profile IKEV2-PROFILE-DMVPN
           match fvrf FDOOR-DMVPN
           match identity remote address 0.0.0.0
           authentication remote pre-share
           authentication local pre-share
           keyring local IKEV2-KEYRING-DMVPN
           lifetime 300
          !
          !
          !
          crypto ipsec transform-set IPSEC-TRANSFORM-SET-DMVPN esp-aes 256 esp-sha512-hmac
           mode transport
          !
          crypto ipsec profile IPSCE-PROFILE-DMVPN
           set transform-set IPSEC-TRANSFORM-SET-DMVPN
           set ikev2-profile IKEV2-PROFILE-DMVPN
          !
          !
          !
          !
          !
          !
          !
          interface Tunnel100
           bandwidth 1000000
           no ip address
           no ip redirects
           delay 50
           ipv6 address FE80:100::1001 link-local
           ipv6 address 6000::6666:1001/112
           ipv6 mtu 1380
           ipv6 tcp adjust-mss 1340
           ipv6 nhrp authentication NHRP-PAS
           ipv6 nhrp network-id 100
           ipv6 nhrp server-only
           ipv6 nhrp redirect
           tunnel source GigabitEthernet0/4
           tunnel mode gre multipoint
           tunnel key 1500
           tunnel vrf FDOOR-DMVPN
           tunnel protection ipsec profile IPSCE-PROFILE-DMVPN
          !
          interface GigabitEthernet0/0
           ip address 132.62.78.18 255.255.255.252
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/1
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/2
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/3
           no ip address
           shutdown
           duplex auto
           speed auto
           media-type rj45
          !
          interface GigabitEthernet0/4
           vrf forwarding FDOOR-DMVPN
           ip address 100.12.20.6 255.255.255.252
           duplex auto
           speed auto
           media-type rj45
          !
          !
          router eigrp DMVPN-OVERLAY
           !
           address-family ipv6 unicast autonomous-system 200
            !
            af-interface default
             shutdown
            exit-af-interface
            !
            af-interface Tunnel100
             summary-address 2001:DB8::10:0:0/96
             no shutdown
             no split-horizon
            exit-af-interface
            !
            topology base
            exit-af-topology
            eigrp router-id 0.1.0.1
           exit-address-family
          !
          ip forward-protocol nd
          !
          !
          no ip http server
          no ip http secure-server
          ip route 0.0.0.0 0.0.0.0 100.12.20.5
          ip route 0.0.0.0 0.0.0.0 132.62.78.17
          ip route vrf FDOOR-DMVPN 0.0.0.0 0.0.0.0 100.12.20.5
          !
          ipv6 ioam timestamp
          !
          !
          !
          control-plane
          !
          banner exec ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner incoming ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          banner login ^C
          **************************************************************************
          * IOSv is strictly limited to use for evaluation, demonstration and IOS  *
          * education. IOSv is provided as-is and is not supported by Cisco's      *
          * Technical Advisory Center. Any use or disclosure, in whole or in part, *
          * of the IOSv Software or Documentation to any third party for any       *
          * purposes is expressly prohibited except as otherwise authorized by     *
          * Cisco in writing.                                                      *
          **************************************************************************^C
          !
          line con 0
           exec-timeout 0 0
          line aux 0
          line vty 0 4
           exec-timeout 0 0
           login
           transport input none
          !
          no scheduler allocate
          !
          end
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n9
    image_definition: null
    label: NHS
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: -560
    y: -240
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
      - id: i5
        label: GigabitEthernet0/4
        slot: 4
        type: physical
  - boot_disk_size: null
    configuration:
      - name: ios_config.txt
        content: |-
          hostname ISP2-0

          int g0/1
           ip add 10.0.10.1 255.255.255.252
           no sh

          int g0/2
           ip add 32.47.82.1 255.255.255.0
           no sh

          ip dhcp excluded-address 32.47.82.1
          ip dhcp pool DHCP-BR1
           network 32.47.82.0 255.255.255.0
           default-router 32.47.82.1
           lease 2

          router ospf 150
           router-id 0.0.2.0
           auto-cost reference-bandwidth 1000000
           redistribute connected subnets
           network 10.0.10.0 0.0.0.3 area 0
    cpu_limit: null
    cpus: null
    data_volume: null
    hide_links: false
    id: n10
    image_definition: null
    label: ISP2-0
    node_definition: iosv
    parameters: {}
    ram: null
    tags: []
    x: -200
    y: -400
    interfaces:
      - id: i0
        label: Loopback0
        type: loopback
      - id: i1
        label: GigabitEthernet0/0
        slot: 0
        type: physical
      - id: i2
        label: GigabitEthernet0/1
        slot: 1
        type: physical
      - id: i3
        label: GigabitEthernet0/2
        slot: 2
        type: physical
      - id: i4
        label: GigabitEthernet0/3
        slot: 3
        type: physical
links:
  - id: l0
    n1: n4
    n2: n3
    i1: i1
    i2: i1
    conditioning: {}
    label: HQ-GigabitEthernet0/0<->ISP1-GigabitEthernet0/0
  - id: l1
    n1: n3
    n2: n1
    i1: i2
    i2: i2
    conditioning: {}
    label: ISP1-GigabitEthernet0/1<->BR1-GigabitEthernet0/1
  - id: l2
    n1: n3
    n2: n2
    i1: i3
    i2: i3
    conditioning: {}
    label: ISP1-GigabitEthernet0/2<->BR2-GigabitEthernet0/2
  - id: l3
    n1: n3
    n2: n0
    i1: i4
    i2: i4
    conditioning:
      latency: 500
      enabled: true
    label: ISP1-GigabitEthernet0/3<->BR3-GigabitEthernet0/3
  - id: l4
    n1: n4
    n2: n6
    i1: i2
    i2: i0
    conditioning: {}
    label: HQ-GigabitEthernet0/1<->PC3-eth0
  - id: l5
    n1: n1
    n2: n5
    i1: i1
    i2: i0
    conditioning: {}
    label: BR1-GigabitEthernet0/0<->PC1-eth0
  - id: l6
    n1: n0
    n2: n7
    i1: i1
    i2: i0
    conditioning: {}
    label: BR3-GigabitEthernet0/0<->PC2-eth0
  - id: l7
    n1: n8
    n2: n4
    i1: i4
    i2: i4
    conditioning: {}
    label: ISP2-1-GigabitEthernet0/3<->HQ-GigabitEthernet0/3
  - id: l8
    n1: n8
    n2: n9
    i1: i1
    i2: i1
    conditioning: {}
    label: ISP2-1-GigabitEthernet0/0<->NHS-GigabitEthernet0/0
  - id: l9
    n1: n3
    n2: n9
    i1: i5
    i2: i5
    conditioning: {}
    label: ISP1-GigabitEthernet0/4<->NHS-GigabitEthernet0/4
  - id: l10
    n1: n8
    n2: n10
    i1: i2
    i2: i2
    conditioning:
      loss: 100
      enabled: true
    label: ISP2-1-GigabitEthernet0/1<->ISP2-0-GigabitEthernet0/1
  - id: l11
    n1: n10
    n2: n1
    i1: i3
    i2: i3
    conditioning: {}
    label: ISP2-0-GigabitEthernet0/2<->BR1-GigabitEthernet0/2
lab:
  description: |-
    IPv6overIPv4 DMVPN Phase 3
    IPSec
    FVRF (Front Door)
    HA in DMVPN (Dual Hub)
    Route Summarization
  notes: ''
  title: DMVPN 03 solution
  version: 0.2.2
